version: "0.5"

environment:
  - "NODE_ENV=development"
  - "LOG_LEVEL=debug"

processes:
  # ============================================================================
  # SIGNET DEVELOPMENT
  # ============================================================================
  signet-dev:
    command: bun run dev
    working_dir: .
    ready_log_line: "Signet CLI ready"
    availability:
      restart: on_failure
      max_restarts: 3

  # ============================================================================
  # REDIS (Cache + Queue) - DISABLED BY DEFAULT
  # ============================================================================
  redis:
    command: redis-server --port 6379
    ready_log_line: "Ready to accept connections"
    disabled: true
    availability:
      restart: on_failure

  # ============================================================================
  # TESTING
  # ============================================================================
  test-watch:
    command: vitest
    working_dir: .
    disabled: true
    availability:
      restart: "no"

  # ============================================================================
  # LINTING
  # ============================================================================
  lint-watch:
    command: oxlint --watch .
    working_dir: .
    disabled: true
    availability:
      restart: "no"

  # ============================================================================
  # TYPE CHECKING
  # ============================================================================
  typecheck-watch:
    command: tsc --noEmit --watch
    working_dir: .
    disabled: true
    availability:
      restart: "no"

# ============================================================================
# PROCESS GROUPS
# ============================================================================
groups:
  dev:
    processes:
      - signet-dev
      - test-watch
      - lint-watch

  full:
    processes:
      - signet-dev
      - redis
      - test-watch

  infra:
    processes:
      - redis
