id: no-truthiness-check
language: typescript
severity: warning
rule:
  kind: if_statement
  has:
    kind: parenthesized_expression
    has:
      any:
        - kind: identifier
          not:
            regex: "^(is|has|should|can|will|does|did|was|were|are|ok|success|valid|enabled|disabled|active|loading|error|exists|found|done|ready|open|closed|visible|hidden|empty|selected|checked|focused|mounted|pending|resolved|rejected|completed|failed|running|stopped|paused|finished|initialized|authenticated|authorized|connected|disconnected|online|offline)"
        - kind: unary_expression
          all:
            - has:
                field: operator
                regex: "^!$"
            - has:
                kind: identifier
                not:
                  regex: "^(is|has|should|can|will|does|did|was|were|are|ok|success|valid|enabled|disabled|active|loading|error|exists|found|done|ready|open|closed|visible|hidden|empty|selected|checked|focused|mounted|pending|resolved|rejected|completed|failed|running|stopped|paused|finished|initialized|authenticated|authorized|connected|disconnected|online|offline)"
message: |
  PARSE-AT-BOUNDARY WARNING (Guard 38): Implicit truthiness check detected.

  Use explicit type narrowing instead of implicit truthiness:

    // WARNING - implicit check (ambiguous semantics)
    if (value) { ... }
    if (!data) { return }

    // BETTER - explicit narrowing
    if (value !== undefined) { ... }
    if (data === null) { return }

    // BEST - discriminated union (no checks needed)
    if (context.phase === "active") {
      context.data  // TypeScript knows data exists
    }

  Why: Implicit truthiness conflates null, undefined, "", 0, and false.

  See: parse-boundary-patterns skill.
note: "See: config/agents/skills/parse-boundary-patterns/SKILL.md"
