agents_dir := env_var("HOME") + "/dotfiles/config/agents"

default:
    @just --list

# Run setup script to create symlinks
install:
    bash ./setup.sh

# Link AGENT.md as CLAUDE.md and GEMINI.md in current project
setup-project:
    ln -sf {{agents_dir}}/AGENT.md ./CLAUDE.md
    ln -sf {{agents_dir}}/AGENT.md ./GEMINI.md
    @echo "✓ Agent context linked"

# Remove agent context files from current project
clean-project:
    rm -f ./CLAUDE.md ./GEMINI.md
    @echo "✓ Agent context removed"

# Show symlink status for all agent configs
status:
    @echo "=== Claude Code CLI ==="
    @ls -la ~/.claude/settings.json 2>/dev/null || echo "  Not configured"
    @ls -la ~/.claude/CLAUDE.md 2>/dev/null || echo "  No CLAUDE.md"
    @echo ""
    @echo "=== Gemini CLI ==="
    @ls -la ~/.gemini/settings.json 2>/dev/null || echo "  Not configured"
    @ls -la ~/.gemini/GEMINI.md 2>/dev/null || echo "  No GEMINI.md"
    @echo ""
    @echo "=== Antigravity ==="
    @ls -la ~/.gemini/antigravity/mcp_config.json 2>/dev/null || echo "  Not configured"
    @echo ""
    @echo "=== Project ==="
    @ls -la ./CLAUDE.md ./GEMINI.md 2>/dev/null || echo "  No context files"

# Validate all JSON config files
validate:
    @jq empty ./settings/claude-code.json && echo "✓ claude-code.json"
    @jq empty ./settings/gemini.json && echo "✓ gemini.json"
    @jq empty ./mcp-servers.json && echo "✓ mcp-servers.json"

# Open AGENT.md in editor
edit:
    ${EDITOR:-nvim} ./AGENT.md

# Install evolution dependencies
evolution-install:
    cd ./evolution && bun install

# Run evolution graders
grade:
    cd ./evolution && bun run grade

# Show evolution metrics
metrics:
    cd ./evolution && bun run metrics

# ============================================================================
# 5-Tier Verification (via Signet CLI)
# ============================================================================

# Run all 5 tiers of verification (hard gate)
verify path=".":
    sig verify {{path}}

# Run verification with auto-fix
verify-fix path=".":
    sig verify --fix {{path}}

# Run only execution tier (typecheck + lint + test)
verify-exec path=".":
    sig verify --tiers execution {{path}}
