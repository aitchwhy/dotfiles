# Global Justfile for Development Workflows
# Run commands with: just <command>

# Configuration
set dotenv-load := true
set positional-arguments := true
set shell := ["zsh", "-c"]

# Default recipe - list all available commands
default:
    @just --list

# Development Environment Setup
# ============================

# Format justfile
fmt:
    just --fmt --unstable -f ~/dotfiles/Justfile

# Platform Development
# ===================

# Run noggin service
run-noggin: deploy-local
    cd ~/src/platform && \
      ant build noggin && \
      ant up noggin

# Run full platform stack
run-platform:
    cd ~/src/platform && \
      ant build api user s3 prefect-worker prefect-agent prefect-server data-seeder && \
      ant up api user s3 prefect-worker prefect-agent prefect-server data-seeder

# Frontend Development
# ===================

# Run development server with hot reloading
run:
    npm run dev --hot

# Get OTP codes from Docker logs
get-otp:
    docker logs "$(docker container ls | rg 'api' | awk '{print $1}')" | rg "sent an otp code"

# Project Setup
# ============

# Install dependencies and build project
setup:
    npm install
    npm run build

# Deployment
# =========

# Deploy to local environment
deploy-local:
    ./deploy-local.sh http://localhost:59000

# Deploy to AWS
deploy-aws profile bucket noggin_url:
    ./deploy-aws.sh {{ profile }} {{ bucket }} {{ noggin_url }}

# Helper Functions
# ===============

# Print help message
help:
    @echo "Available commands:"
    @just --list
