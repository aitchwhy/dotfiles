"use strict";var m=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var T=Object.prototype.hasOwnProperty;var R=(e,n)=>{for(var r in n)m(e,r,{get:n[r],enumerable:!0})},E=(e,n,r,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of I(n))!T.call(e,s)&&s!==r&&m(e,s,{get:()=>n[s],enumerable:!(i=w(n,s))||i.enumerable});return e};var L=e=>E(m({},"__esModule",{value:!0}),e);var C={};R(C,{default:()=>v});module.exports=L(C);var t=require("@raycast/api"),u=require("react");var h=require("@raycast/api"),b=require("node:child_process");var g=class extends Error{},p=class extends Error{},x=class extends Error{},f=class extends Error{},d=class extends Error{};var c=(0,h.getPreferenceValues)(),U=c.tailscalePath&&c.tailscalePath.length>0?c.tailscalePath:"/Applications/Tailscale.app/Contents/MacOS/Tailscale",M=c.tailscaleExecMaxBuffersMB&&c.tailscaleExecMaxBuffersMB?c.tailscaleExecMaxBuffersMB*1024*1024:10*1024*1024;function D(e){try{return(0,b.execSync)(`${U} ${e}`,{maxBuffer:M}).toString().trim()}catch(n){if(n instanceof Error){if(n.message.includes("No such file or directory"))throw new g;if(n.message.includes("is Tailscale running?"))throw new p;if(n.message.includes("spawnSync /bin/sh ENOBUFS"))throw new f;if(n.message.includes('The value of "options.maxBuffer" is out of range. It must be a positive number. Received NaN'))throw new d}throw console.log(`throwing error: ${n}`),n}}function S(e,n){return e instanceof g?{title:"Can\u2019t find the Tailscale CLI",description:`Your Tailscale CLI Path is invalid.
Update your extension preferences to fix this.`}:e instanceof p?{title:"Can\u2019t connect to Tailscale",description:"Make sure Tailscale is running and try again."}:e instanceof x?{title:"Not connected to a tailnet",description:`Tailscale is running, but you\u2019re not connected to a tailnet.
Log in and try again.`}:e instanceof f?{title:"Response larger than buffer size",description:"Increase `Max buffers ...` in the extension configuration."}:e instanceof d?{title:"Invalid `Max buffers ...` configuration",description:"Set `Max buffers ...` to a number in the extension configuration."}:(console.log(`Unhandled error: ${e}`),{title:"Something went wrong",description:n})}var l=require("react/jsx-runtime");function O(e){let n=[];e[0]?.startsWith("ID")&&(e=e.slice(1));for(let r of e){let i=r.split(" ").filter(Boolean),s={};i.length==3?s={name:i[1],active:i[2].includes("*")}:i.length==2&&(s={name:i[1].replace(/\*$/,""),active:i[1].includes("*")}),i.length==1&&(s={name:i[0].replace(/\*$/,""),active:i[0].includes("*")}),n.push(s)}return n}function v(){let[e,n]=(0,u.useState)(),[r,i]=(0,u.useState)();(0,u.useEffect)(()=>{async function o(){try{let y=D("switch --list").split(`
`),N=O(y);n(N)}catch(a){i(S(a,"Couldn\u2019t load users."))}}o()},[]);let s={source:t.Icon.PersonCircle,tintColor:t.Color.Green},P={source:t.Icon.PersonCircle};return(0,l.jsx)(t.List,{isLoading:!e&&!r,children:r?(0,l.jsx)(t.List.EmptyView,{icon:t.Icon.Warning,title:r.title,description:r.description}):e?.sort((o,a)=>+o.active-+a.active).map(o=>(0,l.jsx)(t.List.Item,{title:o.name,icon:o.active?s:P,subtitle:o.active?"Active user":"",actions:(0,l.jsx)(t.ActionPanel,{children:(0,l.jsx)(t.Action,{title:"Switch to User",onAction:async()=>{await(0,t.showToast)({style:t.Toast.Style.Animated,title:"Switching user account",message:`${o.name}`}),(0,t.popToRoot)(),(0,t.closeMainWindow)();let a=D(`switch ${o.name}`);a.includes("Success")||a.includes("Already")?(0,t.showHUD)(`Active Tailscale user is ${o.name}`):(0,t.showHUD)(`Tailscale user failed to switch to ${o.name}`)}})})},o.name))})}
