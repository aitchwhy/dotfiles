"use strict";var D=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var w=Object.prototype.hasOwnProperty;var k=(e,n)=>{for(var s in n)D(e,s,{get:n[s],enumerable:!0})},O=(e,n,s,o)=>{if(n&&typeof n=="object"||typeof n=="function")for(let t of M(n))!w.call(e,t)&&t!==s&&D(e,t,{get:()=>n[t],enumerable:!(o=R(n,t))||o.enumerable});return e};var U=e=>O(D({},"__esModule",{value:!0}),e);var B={};k(B,{default:()=>E});module.exports=U(B);var i=require("@raycast/api"),u=require("react");var y=require("@raycast/api"),S=require("node:child_process"),P="tag:mullvad-exit-node",g=class extends Error{},f=class extends Error{},d=class extends Error{},m=class extends Error{},x=class extends Error{};function N(e=!0){let n=_(`status --json --peers=${e}`),s=JSON.parse(n);if(!s||!s.Self.Online)throw new d;return s}function v(e){let n=[],s=e.Self,o={self:!0,key:s.ID,name:s.DNSName.split(".")[0],userid:s.UserID.toString(),dns:s.DNSName,ipv4:s.TailscaleIPs[0],ipv6:s.TailscaleIPs[1],os:s.OS,online:s.Online,lastseen:new Date(s.LastSeen),exitnode:s.ExitNode,exitnodeoption:s.ExitNodeOption,tags:s.Tags};n.push(o);for(let[,t]of Object.entries(e.Peer)){let c={self:!1,key:t.ID,name:t.DNSName.split(".")[0],userid:t.UserID.toString(),dns:t.DNSName,ipv4:t.TailscaleIPs[0],ipv6:t.TailscaleIPs[1],os:t.OS=="linux"?"Linux":t.OS,online:t.Online,lastseen:new Date(t.LastSeen),exitnode:t.ExitNode,exitnodeoption:t.ExitNodeOption,tags:t.Tags};n.push(c)}return n}function I(e){e.sort((n,s)=>n.self?-1:s.self?1:n.online&&!s.online?-1:!n.online&&s.online?1:n.name.localeCompare(s.name))}var r=(0,y.getPreferenceValues)(),V=r.tailscalePath&&r.tailscalePath.length>0?r.tailscalePath:"/Applications/Tailscale.app/Contents/MacOS/Tailscale",A=r.tailscaleExecMaxBuffersMB&&r.tailscaleExecMaxBuffersMB?r.tailscaleExecMaxBuffersMB*1024*1024:10*1024*1024;function _(e){try{return(0,S.execSync)(`${V} ${e}`,{maxBuffer:A}).toString().trim()}catch(n){if(n instanceof Error){if(n.message.includes("No such file or directory"))throw new g;if(n.message.includes("is Tailscale running?"))throw new f;if(n.message.includes("spawnSync /bin/sh ENOBUFS"))throw new m;if(n.message.includes('The value of "options.maxBuffer" is out of range. It must be a positive number. Received NaN'))throw new x}throw console.log(`throwing error: ${n}`),n}}function C(e,n){return e instanceof g?{title:"Can\u2019t find the Tailscale CLI",description:`Your Tailscale CLI Path is invalid.
Update your extension preferences to fix this.`}:e instanceof f?{title:"Can\u2019t connect to Tailscale",description:"Make sure Tailscale is running and try again."}:e instanceof d?{title:"Not connected to a tailnet",description:`Tailscale is running, but you\u2019re not connected to a tailnet.
Log in and try again.`}:e instanceof m?{title:"Response larger than buffer size",description:"Increase `Max buffers ...` in the extension configuration."}:e instanceof x?{title:"Invalid `Max buffers ...` configuration",description:"Set `Max buffers ...` to a number in the extension configuration."}:(console.log(`Unhandled error: ${e}`),{title:"Something went wrong",description:n})}var a=require("@raycast/api"),l=require("react/jsx-runtime");function b({device:e}){return(0,l.jsxs)(a.ActionPanel,{children:[(0,l.jsx)(a.Action.CopyToClipboard,{content:e.ipv4,title:"Copy IPv4"}),(0,l.jsx)(a.Action.CopyToClipboard,{content:e.dns.endsWith(".")?e.dns.slice(0,-1):e.dns,title:"Copy MagicDNS"}),(0,l.jsx)(a.Action.CopyToClipboard,{content:e.ipv6,title:"Copy IPv6"})]})}var p=require("react/jsx-runtime");function E(){let[e,n]=(0,u.useState)(),[s,o]=(0,u.useState)();return(0,u.useEffect)(()=>{async function t(){try{let c=N(),h=v(c).filter(T=>!T.tags?.includes(P));I(h),n(h)}catch(c){o(C(c,"Couldn\u2019t load device list."))}}t()},[]),(0,p.jsx)(i.List,{isLoading:!e&&!s,children:s?(0,p.jsx)(i.List.EmptyView,{icon:i.Icon.Warning,title:s.title,description:s.description}):e?.map(t=>(0,p.jsx)(i.List.Item,{title:t.name,subtitle:t.ipv4+"   "+t.os,icon:t.online?{source:{light:"connected_light.png",dark:"connected_dark.png"},mask:i.Image.Mask.Circle}:{source:{light:"lastseen_light.png",dark:"lastseen_dark.png"},mask:i.Image.Mask.Circle},accessories:t.self?[{text:"This device",icon:i.Icon.Person},{text:t.online?"        Connected":"Last seen "+L(t.lastseen)}]:[{text:t.online?"        Connected":"Last seen "+L(t.lastseen)}],actions:(0,p.jsx)(b,{device:t})},t.key))})}function L(e){return e.toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"numeric"})}
