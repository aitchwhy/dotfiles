"use strict";var v=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var L=Object.prototype.hasOwnProperty;var M=(t,e)=>{for(var n in e)v(t,n,{get:e[n],enumerable:!0})},k=(t,e,n,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of T(e))!L.call(t,s)&&s!==n&&v(t,s,{get:()=>e[s],enumerable:!(a=w(e,s))||a.enumerable});return t};var A=t=>k(v({},"__esModule",{value:!0}),t);var V={};M(V,{default:()=>R});module.exports=A(V);var i=require("@raycast/api"),c=require("react");var N=require("@raycast/api"),P=require("node:child_process");var u=class extends Error{},g=class extends Error{},p=class extends Error{},d=class extends Error{},f=class extends Error{};function h(t=!0){let e=x(`status --json --peers=${t}`),n=JSON.parse(e);if(!n||!n.Self.Online)throw new p;return n}function y(t){let e=[],n=t.Self,a={self:!0,key:n.ID,name:n.DNSName.split(".")[0],userid:n.UserID.toString(),dns:n.DNSName,ipv4:n.TailscaleIPs[0],ipv6:n.TailscaleIPs[1],os:n.OS,online:n.Online,lastseen:new Date(n.LastSeen),exitnode:n.ExitNode,exitnodeoption:n.ExitNodeOption,tags:n.Tags};e.push(a);for(let[,s]of Object.entries(t.Peer)){let m={self:!1,key:s.ID,name:s.DNSName.split(".")[0],userid:s.UserID.toString(),dns:s.DNSName,ipv4:s.TailscaleIPs[0],ipv6:s.TailscaleIPs[1],os:s.OS=="linux"?"Linux":s.OS,online:s.Online,lastseen:new Date(s.LastSeen),exitnode:s.ExitNode,exitnodeoption:s.ExitNodeOption,tags:s.Tags};e.push(m)}return e}function E(t){t.sort((e,n)=>e.self?-1:n.self?1:e.online&&!n.online?-1:!e.online&&n.online?1:e.name.localeCompare(n.name))}var l=(0,N.getPreferenceValues)(),O=l.tailscalePath&&l.tailscalePath.length>0?l.tailscalePath:"/Applications/Tailscale.app/Contents/MacOS/Tailscale",C=l.tailscaleExecMaxBuffersMB&&l.tailscaleExecMaxBuffersMB?l.tailscaleExecMaxBuffersMB*1024*1024:10*1024*1024;function x(t){try{return(0,P.execSync)(`${O} ${t}`,{maxBuffer:C}).toString().trim()}catch(e){if(e instanceof Error){if(e.message.includes("No such file or directory"))throw new u;if(e.message.includes("is Tailscale running?"))throw new g;if(e.message.includes("spawnSync /bin/sh ENOBUFS"))throw new d;if(e.message.includes('The value of "options.maxBuffer" is out of range. It must be a positive number. Received NaN'))throw new f}throw console.log(`throwing error: ${e}`),e}}function I(t,e){return t instanceof u?{title:"Can\u2019t find the Tailscale CLI",description:`Your Tailscale CLI Path is invalid.
Update your extension preferences to fix this.`}:t instanceof g?{title:"Can\u2019t connect to Tailscale",description:"Make sure Tailscale is running and try again."}:t instanceof p?{title:"Not connected to a tailnet",description:`Tailscale is running, but you\u2019re not connected to a tailnet.
Log in and try again.`}:t instanceof d?{title:"Response larger than buffer size",description:"Increase `Max buffers ...` in the extension configuration."}:t instanceof f?{title:"Invalid `Max buffers ...` configuration",description:"Set `Max buffers ...` to a number in the extension configuration."}:(console.log(`Unhandled error: ${t}`),{title:"Something went wrong",description:e})}var o=require("react/jsx-runtime");function U(t){return y(t).filter(n=>n.exitnodeoption)}function B(t){return t.some(e=>e.exitnode)}function S(t,e){(0,i.popToRoot)(),(0,i.closeMainWindow)(),x(`set --exit-node "${t}"`),e&&x("set --exit-node-allow-lan-access")}function R(){let[t,e]=(0,c.useState)(!1),[n,a]=(0,c.useState)(),[s,m]=(0,c.useState)([]);return(0,c.useEffect)(()=>{async function r(){try{let D=h(),b=U(D);m(b),E(b),B(b)&&e(!0)}catch(D){a(I(D,"Couldn\u2019t load exit nodes."))}}r()},[]),(0,o.jsx)(i.List,{isLoading:!s&&!n,children:n?(0,o.jsx)(i.List.EmptyView,{icon:i.Icon.Warning,title:n.title,description:n.description}):(0,o.jsxs)(o.Fragment,{children:[t&&(0,o.jsx)(i.List.Item,{title:"Turn off exit node",actions:(0,o.jsx)(i.ActionPanel,{children:(0,o.jsx)(i.Action,{title:"Turn Off Exit Node",onAction:()=>S("",!1)})})},"_disable"),s?.map(r=>(0,o.jsx)(i.List.Item,{title:r.name,subtitle:r.ipv4+"    "+r.os,icon:r.online?{source:{light:"connected_light.png",dark:"connected_dark.png"},mask:i.Image.Mask.Circle}:{source:{light:"lastseen_light.png",dark:"lastseen_dark.png"},mask:i.Image.Mask.Circle},accessories:[{tag:r.exitnode?"Connected":""}],actions:(0,o.jsxs)(i.ActionPanel,{children:[(0,o.jsx)(i.Action,{title:"Use as Exit Node",onAction:()=>S(r.dns,!1)}),(0,o.jsx)(i.Action,{title:"Use as Exit Node and Allow LAN Access",onAction:()=>S(r.dns,!0)})]})},r.key))]})})}
