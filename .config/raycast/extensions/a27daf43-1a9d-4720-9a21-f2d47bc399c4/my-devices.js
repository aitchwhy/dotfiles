"use strict";var D=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var M=Object.prototype.hasOwnProperty;var w=(e,n)=>{for(var i in n)D(e,i,{get:n[i],enumerable:!0})},k=(e,n,i,o)=>{if(n&&typeof n=="object"||typeof n=="function")for(let t of R(n))!M.call(e,t)&&t!==i&&D(e,t,{get:()=>n[t],enumerable:!(o=E(n,t))||o.enumerable});return e};var O=e=>k(D({},"__esModule",{value:!0}),e);var A={};w(A,{default:()=>C});module.exports=O(A);var s=require("@raycast/api"),u=require("react");var h=require("@raycast/api"),y=require("node:child_process");var g=class extends Error{},f=class extends Error{},d=class extends Error{},m=class extends Error{},x=class extends Error{};function P(e=!0){let n=V(`status --json --peers=${e}`),i=JSON.parse(n);if(!i||!i.Self.Online)throw new d;return i}function N(e){let n=[],i=e.Self,o={self:!0,key:i.ID,name:i.DNSName.split(".")[0],userid:i.UserID.toString(),dns:i.DNSName,ipv4:i.TailscaleIPs[0],ipv6:i.TailscaleIPs[1],os:i.OS,online:i.Online,lastseen:new Date(i.LastSeen),exitnode:i.ExitNode,exitnodeoption:i.ExitNodeOption,tags:i.Tags};n.push(o);for(let[,t]of Object.entries(e.Peer)){let r={self:!1,key:t.ID,name:t.DNSName.split(".")[0],userid:t.UserID.toString(),dns:t.DNSName,ipv4:t.TailscaleIPs[0],ipv6:t.TailscaleIPs[1],os:t.OS=="linux"?"Linux":t.OS,online:t.Online,lastseen:new Date(t.LastSeen),exitnode:t.ExitNode,exitnodeoption:t.ExitNodeOption,tags:t.Tags};n.push(r)}return n}function v(e){e.sort((n,i)=>n.self?-1:i.self?1:n.online&&!i.online?-1:!n.online&&i.online?1:n.name.localeCompare(i.name))}var a=(0,h.getPreferenceValues)(),U=a.tailscalePath&&a.tailscalePath.length>0?a.tailscalePath:"/Applications/Tailscale.app/Contents/MacOS/Tailscale",B=a.tailscaleExecMaxBuffersMB&&a.tailscaleExecMaxBuffersMB?a.tailscaleExecMaxBuffersMB*1024*1024:10*1024*1024;function V(e){try{return(0,y.execSync)(`${U} ${e}`,{maxBuffer:B}).toString().trim()}catch(n){if(n instanceof Error){if(n.message.includes("No such file or directory"))throw new g;if(n.message.includes("is Tailscale running?"))throw new f;if(n.message.includes("spawnSync /bin/sh ENOBUFS"))throw new m;if(n.message.includes('The value of "options.maxBuffer" is out of range. It must be a positive number. Received NaN'))throw new x}throw console.log(`throwing error: ${n}`),n}}function I(e,n){return e instanceof g?{title:"Can\u2019t find the Tailscale CLI",description:`Your Tailscale CLI Path is invalid.
Update your extension preferences to fix this.`}:e instanceof f?{title:"Can\u2019t connect to Tailscale",description:"Make sure Tailscale is running and try again."}:e instanceof d?{title:"Not connected to a tailnet",description:`Tailscale is running, but you\u2019re not connected to a tailnet.
Log in and try again.`}:e instanceof m?{title:"Response larger than buffer size",description:"Increase `Max buffers ...` in the extension configuration."}:e instanceof x?{title:"Invalid `Max buffers ...` configuration",description:"Set `Max buffers ...` to a number in the extension configuration."}:(console.log(`Unhandled error: ${e}`),{title:"Something went wrong",description:n})}var l=require("@raycast/api"),c=require("react/jsx-runtime");function S({device:e}){return(0,c.jsxs)(l.ActionPanel,{children:[(0,c.jsx)(l.Action.CopyToClipboard,{content:e.ipv4,title:"Copy IPv4"}),(0,c.jsx)(l.Action.CopyToClipboard,{content:e.dns.endsWith(".")?e.dns.slice(0,-1):e.dns,title:"Copy MagicDNS"}),(0,c.jsx)(l.Action.CopyToClipboard,{content:e.ipv6,title:"Copy IPv6"})]})}var p=require("react/jsx-runtime");function C(){let[e,n]=(0,u.useState)(),[i,o]=(0,u.useState)();return(0,u.useEffect)(()=>{async function t(){try{let r=P(),L=r.Self.UserID.toString(),b=N(r).filter(T=>T.userid===L);v(b),n(b)}catch(r){o(I(r,"Couldn\u2019t load device list."))}}t()},[]),(0,p.jsx)(s.List,{isLoading:!e&&!i,children:i?(0,p.jsx)(s.List.EmptyView,{icon:s.Icon.Warning,title:i.title,description:i.description}):e?.map(t=>(0,p.jsx)(s.List.Item,{title:t.name,subtitle:t.ipv4+"    "+t.os,icon:t.online?{source:{light:"connected_light.png",dark:"connected_dark.png"},mask:s.Image.Mask.Circle}:{source:{light:"lastseen_light.png",dark:"lastseen_dark.png"},mask:s.Image.Mask.Circle},accessories:t.self?[{text:"This device",icon:s.Icon.Person},{text:t.online?"        Connected":"Last seen "+t.lastseen.toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"numeric"})}]:[{text:t.online?"        Connected":"Last seen "+t.lastseen.toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"numeric"})}],actions:(0,p.jsx)(S,{device:t})},t.key))})}
