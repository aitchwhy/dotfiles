"use strict";var D=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames;var O=Object.prototype.hasOwnProperty;var $=(e,i)=>{for(var a in i)D(e,a,{get:i[a],enumerable:!0})},U=(e,i,a,o)=>{if(i&&typeof i=="object"||typeof i=="function")for(let s of V(i))!O.call(e,s)&&s!==a&&D(e,s,{get:()=>i[s],enumerable:!(o=w(i,s))||o.enumerable});return e};var B=e=>U(D({},"__esModule",{value:!0}),e);var H={};$(H,{default:()=>h,derpDetails:()=>L});module.exports=B(H);var t=require("@raycast/api"),l=require("react");var x=require("@raycast/api"),v=require("node:child_process");var f=class extends Error{},d=class extends Error{},b=class extends Error{},m=class extends Error{},P=class extends Error{};function N(){let e=R("netcheck --format json");return JSON.parse(e)}function S(){let e=R("debug netmap");return JSON.parse(e).DERPMap.Regions}var c=(0,x.getPreferenceValues)(),A=c.tailscalePath&&c.tailscalePath.length>0?c.tailscalePath:"/Applications/Tailscale.app/Contents/MacOS/Tailscale",G=c.tailscaleExecMaxBuffersMB&&c.tailscaleExecMaxBuffersMB?c.tailscaleExecMaxBuffersMB*1024*1024:10*1024*1024;function R(e){try{return(0,v.execSync)(`${A} ${e}`,{maxBuffer:G}).toString().trim()}catch(i){if(i instanceof Error){if(i.message.includes("No such file or directory"))throw new f;if(i.message.includes("is Tailscale running?"))throw new d;if(i.message.includes("spawnSync /bin/sh ENOBUFS"))throw new m;if(i.message.includes('The value of "options.maxBuffer" is out of range. It must be a positive number. Received NaN'))throw new P}throw console.log(`throwing error: ${i}`),i}}function C(e,i){return e instanceof f?{title:"Can\u2019t find the Tailscale CLI",description:`Your Tailscale CLI Path is invalid.
Update your extension preferences to fix this.`}:e instanceof d?{title:"Can\u2019t connect to Tailscale",description:"Make sure Tailscale is running and try again."}:e instanceof b?{title:"Not connected to a tailnet",description:`Tailscale is running, but you\u2019re not connected to a tailnet.
Log in and try again.`}:e instanceof m?{title:"Response larger than buffer size",description:"Increase `Max buffers ...` in the extension configuration."}:e instanceof P?{title:"Invalid `Max buffers ...` configuration",description:"Set `Max buffers ...` to a number in the extension configuration."}:(console.log(`Unhandled error: ${e}`),{title:"Something went wrong",description:i})}var n=require("react/jsx-runtime"),k=(e,i)=>{let a=S();return Object.keys(e.RegionLatency).map(o=>{let s=parseInt(o),u={id:o,code:a[s].RegionCode,name:a[s].RegionName,latency:e.RegionLatency[o]?(e.RegionLatency[o]/1e6).toFixed(1):void 0,latencies:{v4:e.RegionV4Latency[o]?(e.RegionV4Latency[o]/1e6).toFixed(1):void 0,v6:e.RegionV6Latency[o]?(e.RegionV6Latency[o]/1e6).toFixed(1):void 0},nodes:a[s].Nodes};return e.PreferredDERP===s&&i(u),u}).sort((o,s)=>o.latency&&s.latency?parseFloat(o.latency)-parseFloat(s.latency):o.latency?1:s.latency?-1:0)};function h(){let[e,i]=(0,l.useState)(),[a,o]=(0,l.useState)([]),[s,u]=(0,l.useState)([]),[E,T]=(0,l.useState)(),[g,M]=(0,l.useState)();return(0,l.useEffect)(()=>{async function r(){try{let p=N();u(k(p,T)),i(p),o(["UPnP","PMP","PCP"].reduce((y,I)=>(p[I]&&y.push(I),y),[]))}catch(p){M(C(p,"Couldn\u2019t load netcheck."))}}r()},[]),(0,n.jsx)(t.List,{isLoading:!e&&!a&&!g,children:g?(0,n.jsx)(t.List.EmptyView,{icon:t.Icon.Warning,title:g.title,description:g.description}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.List.Item,{title:"UDP",subtitle:String(e?.UDP)}),(0,n.jsx)(t.List.Item,{title:"IPv4",subtitle:`${e?.IPv4?`yes, ${e?.GlobalV4}`:"no"}`,actions:(0,n.jsxs)(t.ActionPanel,{children:[e?.IPv4&&(0,n.jsx)(t.Action.CopyToClipboard,{title:"Copy IPv4",content:e?.GlobalV4}),e?.IPv4&&(0,n.jsx)(t.Action.Paste,{title:"Paste IPv4",content:e?.GlobalV4})]})}),(0,n.jsx)(t.List.Item,{title:"IPv6",subtitle:`${e?.IPv6?`yes, ${e?.GlobalV6}`:"no"}`,actions:(0,n.jsxs)(t.ActionPanel,{children:[e?.IPv6&&(0,n.jsx)(t.Action.CopyToClipboard,{title:"Copy IPv6",content:e?.GlobalV6}),e?.IPv6&&(0,n.jsx)(t.Action.Paste,{title:"Paste IPv6",content:e?.GlobalV6})]})}),(0,n.jsx)(t.List.Item,{title:"Mapping Varies by Destination IP",subtitle:String(e?.MappingVariesByDestIP)}),(0,n.jsx)(t.List.Item,{title:"Port Mapping",subtitle:a.join(", ")}),(0,n.jsx)(t.List.Item,{title:"Nearest DERP",subtitle:E?.name}),(0,n.jsx)(t.List.Section,{title:"DERP Regions",children:s.map(r=>(0,n.jsx)(t.List.Item,{title:r.code,subtitle:`${r.name} \xB7 ${r.nodes?.length} node${r.nodes?.length===1?"":"s"}`,accessories:[...r.id===String(e?.PreferredDERP)?[{icon:{source:t.Icon.Star,tintColor:t.Color.Yellow}}]:[],{text:`${r.latency} ms`}],keywords:[r.id,r.name],actions:(0,n.jsxs)(t.ActionPanel,{children:[(0,n.jsx)(t.Action.Push,{title:"Open Details",target:L(r)}),(0,n.jsx)(t.Action.CopyToClipboard,{title:"Copy Name",content:r.name}),(0,n.jsx)(t.Action.CopyToClipboard,{title:"Copy Code",content:r.code}),r.latency&&(0,n.jsx)(t.Action.CopyToClipboard,{title:"Copy Latency",content:r.latency})]})},r.id))})]})})}function L(e){return(0,n.jsxs)(t.List,{navigationTitle:`${e.code} (${e.name})`,children:[(0,n.jsx)(t.List.Item,{title:"Code",subtitle:e.code}),(0,n.jsx)(t.List.Item,{title:"Name",subtitle:e.name}),(0,n.jsx)(t.List.Item,{title:"ID",subtitle:e.id}),(0,n.jsxs)(t.List.Section,{title:"Latencies",children:[e.latencies.v4&&(0,n.jsx)(t.List.Item,{title:"IPv4",subtitle:`${e.latencies.v4} ms`}),e.latencies.v6&&(0,n.jsx)(t.List.Item,{title:"IPv6",subtitle:`${e.latencies.v6} ms`})]}),(0,n.jsx)(t.List.Section,{title:"Servers",children:e.nodes?.map(i=>(0,n.jsx)(t.List.Item,{title:i.Name,subtitle:i.HostName,keywords:[i.HostName,i.IPv4,i.IPv6],actions:(0,n.jsxs)(t.ActionPanel,{children:[(0,n.jsx)(t.Action.CopyToClipboard,{title:"Copy Hostname",content:i.HostName}),i.IPv4&&(0,n.jsx)(t.Action.CopyToClipboard,{title:"Copy IPv4",content:i.IPv4}),i.IPv6&&(0,n.jsx)(t.Action.CopyToClipboard,{title:"Copy IPv6",content:i.IPv6})]})},i.Name))})]})}0&&(module.exports={derpDetails});
