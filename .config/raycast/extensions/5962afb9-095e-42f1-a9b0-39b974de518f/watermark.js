"use strict";var z=Object.create;var d=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var E=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var O=(t,e)=>{for(var r in e)d(t,r,{get:e[r],enumerable:!0})},y=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of C(e))!N.call(t,n)&&n!==r&&d(t,n,{get:()=>e[n],enumerable:!(s=j(e,n))||s.enumerable});return t};var b=(t,e,r)=>(r=t!=null?z(E(t)):{},y(e||!t||!t.__esModule?d(r,"default",{value:t,enumerable:!0}):r,t)),B=t=>y(d({},"__esModule",{value:!0}),t);var I={};O(I,{default:()=>D});module.exports=B(I);var o=require("@raycast/api"),w=b(require("path"));var g=require("@raycast/api"),h=require("path"),S=require("fs/promises"),F=require("child_process");async function x(t,...e){let r=(0,h.join)(g.environment.assetsPath,"compiled_raycast_swift/swift");return await(0,S.chmod)(r,"755"),new Promise((s,n)=>{let f=[t];for(let m of e)try{f.push(JSON.stringify(m,(i,u)=>u===void 0?null:u))}catch(i){n(new l("Failed to serialize input to JSON: "+i.message));return}let c=(0,F.spawn)(r,f),a=[],p=[];c.stdout?.on("data",m=>{a.push(m.toString())}),c.stderr?.on("data",m=>{p.push(m.toString())}),c.on("exit",m=>{if(m===0)try{let i=a.join("").trim();i.length!=0?s(JSON.parse(i)):s(null)}catch(i){let u=new l("Failed to deserialize result from JSON: "+i.message);u.stdout=a.join("").trim(),u.stderr=p.join("").trim(),n(u)}else{let i=new l(p.join("").trim()||a.join("").trim()||"Could not get any data");i.stdout=a.join("").trim(),i.stderr=p.join("").trim(),n(i)}}),c.on("error",m=>{n(m)})})}async function P(t){return await x("isPDFDocumentLocked",t)}async function k(t,e,r,s,n){return await x("watermark",t,e,r,s,n)}var l=class extends Error{constructor(e){super(e),this.name="SwiftError"}};async function D(t){try{let{text:e,fontSize:r}=t.arguments,s=(0,o.getPreferenceValues)(),n=parseFloat(s.transparency),f=parseInt(s.rotation),c=await(0,o.getSelectedFinderItems)();if(c.length===0)throw new Error("No files have been selected in Finder");for(let a of c){if(w.default.extname(a.path).toLowerCase()!==".pdf")throw new Error("Only PDF files should be selected in Finder");if(await P(a.path))throw new Error(`"${w.default.basename(a.path)}" is password-protected`)}await(0,o.closeMainWindow)();for(let a of c)await(0,o.showToast)({style:o.Toast.Style.Animated,title:`Watermarking "${w.default.basename(a.path)}"`}),await k(a.path,e,n,f,r?parseInt(r):void 0);await(0,o.showToast)({style:o.Toast.Style.Success,title:`PDF file${c.length>1?"s":""} watermarked successfully`})}catch(e){await(0,o.showToast)({style:o.Toast.Style.Failure,title:e instanceof Error?e.message:String(e)})}}
