"use strict";var j=Object.create;var p=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,O=Object.prototype.hasOwnProperty;var b=(t,e)=>{for(var r in e)p(t,r,{get:e[r],enumerable:!0})},y=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of E(e))!O.call(t,s)&&s!==r&&p(t,s,{get:()=>e[s],enumerable:!(o=C(e,s))||o.enumerable});return t};var z=(t,e,r)=>(r=t!=null?j(N(t)):{},y(e||!t||!t.__esModule?p(r,"default",{value:t,enumerable:!0}):r,t)),B=t=>y(p({},"__esModule",{value:!0}),t);var J={};b(J,{default:()=>D});module.exports=B(J);var n=require("@raycast/api"),f=z(require("path"));var h=require("@raycast/api"),g=require("path"),S=require("fs/promises"),F=require("child_process");async function x(t,...e){let r=(0,g.join)(h.environment.assetsPath,"compiled_raycast_swift/swift");return await(0,S.chmod)(r,"755"),new Promise((o,s)=>{let w=[t];for(let a of e)try{w.push(JSON.stringify(a,(i,c)=>c===void 0?null:c))}catch(i){s(new u("Failed to serialize input to JSON: "+i.message));return}let l=(0,F.spawn)(r,w),m=[],d=[];l.stdout?.on("data",a=>{m.push(a.toString())}),l.stderr?.on("data",a=>{d.push(a.toString())}),l.on("exit",a=>{if(a===0)try{let i=m.join("").trim();i.length!=0?o(JSON.parse(i)):o(null)}catch(i){let c=new u("Failed to deserialize result from JSON: "+i.message);c.stdout=m.join("").trim(),c.stderr=d.join("").trim(),s(c)}else{let i=new u(d.join("").trim()||m.join("").trim()||"Could not get any data");i.stdout=m.join("").trim(),i.stderr=d.join("").trim(),s(i)}}),l.on("error",a=>{s(a)})})}async function P(t){return await x("isPDFDocumentLocked",t)}async function k(t,e){return await x("protect",t,e)}var u=class extends Error{constructor(e){super(e),this.name="SwiftError"}};async function D(t){try{let{password:e}=t.arguments,r=await(0,n.getSelectedFinderItems)();if(r.length===0)throw new Error("No files have been selected in Finder");for(let o of r){if(f.default.extname(o.path).toLowerCase()!==".pdf")throw new Error("Only PDF files should be selected in Finder");if(await P(o.path))throw new Error(`"${f.default.basename(o.path)}" is already password-protected`)}await(0,n.closeMainWindow)();for(let o of r)await(0,n.showToast)({style:n.Toast.Style.Animated,title:`Protecting "${f.default.basename(o.path)}"`}),await k(o.path,e);await(0,n.showToast)({style:n.Toast.Style.Success,title:`PDF file${r.length>1?"s":""} protected successfully`})}catch(e){await(0,n.showToast)({style:n.Toast.Style.Failure,title:e instanceof Error?e.message:String(e)})}}
