"use strict";var f=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var A=Object.prototype.hasOwnProperty;var $=(t,n)=>{for(var i in n)f(t,i,{get:n[i],enumerable:!0})},b=(t,n,i,o)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of h(n))!A.call(t,s)&&s!==i&&f(t,s,{get:()=>n[s],enumerable:!(o=P(n,s))||o.enumerable});return t};var I=t=>b(f({},"__esModule",{value:!0}),t);var M={};$(M,{default:()=>y});module.exports=I(M);var e=require("@raycast/api"),p=require("child_process"),d=require("react"),r=require("react/jsx-runtime"),L=[{label:"Finder",process:"Finder",icon:e.Icon.Finder},{label:"Dock",process:"Dock",icon:e.Icon.Desktop},{label:"Audio",process:"coreaudiod",icon:e.Icon.Speaker},{label:"Bluetooth",process:"bluetoothd",icon:e.Icon.Bluetooth},{label:"WindowServer",process:"-HUP WindowServer",icon:e.Icon.Window,warning:"This will close all open applications and log you out."},{label:"SystemUIServer (e.g. Menu Bar)",process:"SystemUIServer",icon:e.Icon.ComputerChip}];async function w(){return JSON.parse(await e.LocalStorage.getItem("order")||"[]")}async function k(t){let n=await w();return t.sort((i,o)=>{let s=n.indexOf(typeof i=="string"?i:i.process),a=n.indexOf(typeof o=="string"?o:o.process);return s===-1&&(s=n.length),a===-1&&(a=n.length),s-a})}async function O(t){let n=await w(),i=[t,...n.filter(o=>o!==t)];await e.LocalStorage.setItem("order",JSON.stringify(i))}function v(){return new Promise((t,n)=>{(0,p.exec)(`launchctl list | grep com.apple | awk '{print $3}'
`,(i,o)=>{if(i){console.error(`exec error: ${i}`),n(i);return}let a=o.split(`
`).map(l=>l.trim()).map(l=>(0,r.jsx)(e.List.Item,{title:l,actions:(0,r.jsx)(e.ActionPanel,{children:(0,r.jsx)(e.Action,{title:"Restart",onAction:async()=>{await S({advancedMode:l})}})})},l));t(a)})})}async function g(t){let n=await new Promise(o=>{(0,p.exec)(`which ${t}`,(s,a)=>{o(s?null:a.trim())})});if(n)return n;let i=[`/usr/bin/${t}`,`/bin/${t}`,`/usr/sbin/${t}`,`/sbin/${t}`];for(let o of i)if(await new Promise(s=>{(0,p.exec)(`type ${o}`,a=>{s(!a)})}))return o;return null}function y(){let{push:t}=(0,e.useNavigation)(),[n,i]=(0,d.useState)([]);return(0,d.useEffect)(()=>{k(L).then(i)},[]),(0,r.jsxs)(e.List,{isLoading:n.length===0,children:[(0,r.jsx)(e.List.Section,{title:"Common",children:n.map(o=>(0,r.jsx)(e.List.Item,{title:o.label,icon:o.icon,actions:(0,r.jsx)(e.ActionPanel,{children:(0,r.jsx)(e.Action,{title:"Restart",onAction:async()=>{await S({process:o})}})})},o.process))}),n.length?(0,r.jsx)(e.List.Section,{title:"Advanced",children:(0,r.jsx)(e.List.Item,{title:"Advanced Mode...",icon:e.Icon.BulletPoints,actions:(0,r.jsx)(e.ActionPanel,{children:(0,r.jsx)(e.Action,{title:"View All Running Services",onAction:async()=>{t((0,r.jsx)(x,{}))}})})},"advanced")}):null]})}function x(){let[t,n]=(0,d.useState)([]);return(0,d.useEffect)(()=>{v().then(n)},[]),(0,r.jsx)(e.List,{isLoading:t.length===0,children:t})}async function S(t){let i=(0,e.getPreferenceValues)().useSudo?"sudo":"",o="process"in t?t.process.label:t.advancedMode,s="";if(!process){await(0,e.showToast)(e.Toast.Style.Failure,"No process selected");return}if(await(0,e.clearSearchBar)(),await(0,e.closeMainWindow)(),"process"in t){if(t.process.warning){let u=!1;if(await(0,e.confirmAlert)({title:"Warning",message:t.process.warning,icon:e.Icon.Warning,primaryAction:{title:"Continue",style:e.Alert.ActionStyle.Destructive,onAction:()=>{u=!0}}}),!u)return}let c=await g("killall");if(!c){await(0,e.showToast)(e.Toast.Style.Failure,"killall executable not found");return}s=`${i} ${c} -KILL ${t.process.process}`}else{let c=await g("launchctl");if(!c){await(0,e.showToast)(e.Toast.Style.Failure,"launchctl executable not found");return}s=`${i} ${c} stop ${t.advancedMode}`}await O("process"in t?t.process.process:t.advancedMode);let a=!0,l=(0,p.exec)(s,(c,u,m)=>{c&&(console.log(`exec error: ${c}`),(0,e.showToast)(e.Toast.Style.Failure,`Error: ${c.message}`),a=!1),m&&console.log(`stderr: ${m}`),u&&console.log(`stdout: ${u}`)});await new Promise(c=>{l.on("exit",c)}),await new Promise(c=>{setTimeout(c,5)}),a&&await(0,e.showToast)(e.Toast.Style.Success,`${o} restarted`)}
